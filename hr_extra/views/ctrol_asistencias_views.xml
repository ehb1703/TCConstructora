<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista List de ctrol.asistencias -->
    <record id="view_ctrol_asistencias_tree" model="ir.ui.view">
        <field name="name">ctrol.asistencias.tree</field>
        <field name="model">ctrol.asistencias</field>
        <field name="arch" type="xml">
            <list string="Asistencias Checadores" decoration-success="log_status=='importada' and status=='success'" decoration-danger="log_status=='error' or status=='error'" decoration-warning="log_status=='pendiente'">
                <field name="id"/>
                <field name="registration_number"/>
                <field name="employee_name"/>
                <field name="check_type"/>
                <field name="check_date"/>
                <field name="status" decoration-success="status=='success'" decoration-danger="status=='error'" widget="badge"/>
                <field name="log_status"/>
                <field name="attendance_id" optional="show" string="Asistencia Odoo"/>
                <field name="lateness_time"/>
                <field name="verification_status"/>
                <field name="match_percentage"/>
                <field name="observaciones" optional="hide"/>
                <field name="createdAt"/>
            </list>
        </field>
    </record>

    <!-- Vista Form de ctrol.asistencias -->
    <record id="view_ctrol_asistencias_form" model="ir.ui.view">
        <field name="name">ctrol.asistencias.form</field>
        <field name="model">ctrol.asistencias</field>
        <field name="arch" type="xml">
            <form string="Asistencia Checador">
                <header>
                    <field name="log_status" widget="statusbar" statusbar_visible="pendiente,importada"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <widget name="web_ribbon" title="Error" bg_color="text-bg-danger" invisible="status != 'error'"/>
                    </div>
                    <group>
                        <group string="Información del Empleado">
                            <field name="registration_number"/>
                            <field name="employee_id" invisible="1"/>
                            <field name="employee_name"/>
                            <field name="check_type"/>
                            <field name="check_date"/>
                        </group>
                        <group string="Estado de Validación">
                            <field name="status" widget="badge" decoration-success="status=='success'" decoration-danger="status=='error'"/>
                            <field name="observaciones" placeholder="Detalles del error o advertencia..."/>
                        </group>
                    </group>
                    <group>
                        <group string="Tiempo y Estado">
                            <field name="lateness_time"/>
                            <field name="left_early_time"/>
                            <field name="is_active"/>
                            <field name="verification_status"/>
                            <field name="match_percentage"/>
                        </group>
                        <group string="Ubicación GPS">
                            <field name="latitude"/>
                            <field name="longitude"/>
                            <field name="photo_url" widget="url"/>
                        </group>
                    </group>
                    <group string="Información de Log">
                        <field name="log_message" colspan="2"/>
                        <field name="attendance_id" string="Asistencia Odoo Generada" invisible="attendance_id == False"/>
                        <field name="sigob_log_folio"/>
                        <field name="user_valid_id"/>
                        <field name="date_validated"/>
                    </group>
                    <group string="Timestamps">
                        <group>
                            <field name="createdAt" readonly="1"/>
                        </group>
                        <group>
                            <field name="updatedAt" readonly="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Vista Search de ctrol.asistencias -->
    <record id="view_ctrol_asistencias_search" model="ir.ui.view">
        <field name="name">ctrol.asistencias.search</field>
        <field name="model">ctrol.asistencias</field>
        <field name="arch" type="xml">
            <search string="Buscar Asistencias">
                <field name="registration_number" string="Núm. Empleado"/>
                <field name="employee_name"/>
                <field name="check_date"/>
                <field name="observaciones"/>
                <separator/>
                <filter string="Entrada" name="entrada" domain="[('check_type', '=', 'entrada')]"/>
                <filter string="Salida" name="salida" domain="[('check_type', '=', 'salida')]"/>
                <separator/>
                <filter string="Pendiente" name="pendiente" domain="[('log_status', '=', 'pendiente')]"/>
                <filter string="Importada" name="importada" domain="[('log_status', '=', 'importada')]"/>
                <filter string="Error Log" name="error_log" domain="[('log_status', '=', 'error')]"/>
                <separator/>
                <filter string="Validación OK" name="status_success" domain="[('status', '=', 'success')]"/>
                <filter string="Validación Error" name="status_error" domain="[('status', '=', 'error')]"/>
                <separator/>
                <filter string="Hoy" name="today" domain="[('check_date', '&gt;=', context_today().strftime('%Y-%m-%d 00:00:00')), ('check_date', '&lt;=', context_today().strftime('%Y-%m-%d 23:59:59'))]"/>
                <filter string="Esta Semana" name="this_week" domain="[('check_date', '&gt;=', (context_today() - relativedelta(weeks=1)).strftime('%Y-%m-%d')), ('check_date', '&lt;=', context_today().strftime('%Y-%m-%d'))]"/>
                <group expand="0" string="Agrupar Por">
                    <filter string="Núm. Empleado" name="group_registration" context="{'group_by': 'registration_number'}"/>
                    <filter string="Empleado" name="group_employee" context="{'group_by': 'employee_name'}"/>
                    <filter string="Tipo" name="group_type" context="{'group_by': 'check_type'}"/>
                    <filter string="Estado Log" name="group_log_status" context="{'group_by': 'log_status'}"/>
                    <filter string="Estado Validación" name="group_status" context="{'group_by': 'status'}"/>
                    <filter string="Fecha" name="group_date" context="{'group_by': 'check_date:day'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Acción de Menú -->
    <record id="action_ctrol_asistencias" model="ir.actions.act_window">
        <field name="name">Asistencias Checadores</field>
        <field name="res_model">ctrol.asistencias</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_today': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Registros de asistencias desde checadores biométricos
            </p>
            <p>
                Esta tabla contiene los registros crudos recibidos desde los checadores.
            </p>
        </field>
    </record>

    <menuitem id="menu_api_checadores" name="Checadores" parent="hr.menu_hr_root" sequence="50">
        <menuitem id="menu_ctrol_asistencias" name="Asistencias Checadores" action="action_ctrol_asistencias" sequence="10"/>
    </menuitem>
</odoo>
