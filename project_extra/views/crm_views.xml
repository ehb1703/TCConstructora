<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_crm_lead_kanban" model="ir.ui.view">
        <field name="name">view.crm.lead.kanban</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="records_draggable">False</attribute>
            </xpath>
        </field>
    </record>
    
    <record id="view_crm_lead_convocatorias_form" model="ir.ui.view">
        <field name="name">view.crm.lead.convocatorias.form</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form"/>
        <field name="arch" type="xml">

            <xpath expr="//form" position="attributes">
                <attribute name="delete">0</attribute>
                <attribute name="duplicate">0</attribute>
            </xpath>

            <xpath expr="//field[@name='stage_id']" position="before">
                <!-- Solicitar autorización -->
                <field name="in_calificado" invisible="1"/>
                <field name="stage_name" invisible="1"/>
                <field name="stage_previous" invisible="1"/>
                <button name="action_request_authorization" type="object" string="Solicitar autorización" class="btn-secondary" invisible="not in_calificado"/>
                <!-- Autorizar convocatoria -->
                <button name="action_authorize" type="object" string="Autorizar convocatoria" class="oe_highlight" groups="project_extra.group_conv_authorizer" invisible="not in_calificado"/>
                <!-- Declinar convocatoria -->
                <button name="action_decline" type="object" string="Declinar convocatoria" class="btn-danger" groups="project_extra.group_conv_authorizer" invisible="not in_calificado or stage_name == 'Declinado'"/>
                <!-- Regresar etapa (visible solo cuando está en Calificado) -->
                <button name="action_advance_stage" type="object" string="Avanzar etapa" class="btn-secondary" invisible="stage_name in ('Nuevas Convocatorias', 'Junta de Fallo', 'Declinado', 'Ganado')"/>
                <button name="action_revert_stage" type="object" string="Regresar etapa" class="btn-secondary" invisible="stage_name in ('Nuevas Convocatorias', 'Declinado')"/>
                <button name="action_genera_ordenventa" type="object" string="Orden de venta" class="btn-secondary" invisible="stage_name != 'Ganado'"/>
            </xpath>

            <!-- Agregar botón de Documentos en la caja de botones -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_documents" type="object" class="oe_stat_button" icon="fa-folder-open">
                    <field name="documents_count" widget="statinfo" string="Documentos"/>
                </button>
            </xpath>

            <xpath expr="//button[@name='action_set_won_rainbowman']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='stage_id']" position="attributes">
                <attribute name="options">{'clickable': 0}</attribute>
            </xpath>

            <xpath expr="//field[@name='expected_revenue']" position="attributes">
                <attribute name="string">Capital contable</attribute>
            </xpath>

            <xpath expr="//notebook" position="before">
                <group>
                    <field name="origen_id" string="Tipo de Venta" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                </group>
                <group string="Información Convocatoria" invisible="origen_name != 'Público'">
                    <group>
                        <field name="req_bases" invisible="1"/>
                        <field name="partner_emisor_id" options="{'no_open':True, 'no_create':True}"/>
                        <field name="no_licitacion"/>
                        <field name="desc_licitacion"/>
                        <field name="tipo_obra_id" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                        <field name="zona_geografica_id" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                    </group>
                    <group>
                        <field name="especialidad_ids" widget="many2many_tags" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                        <field name="fecha_convocatoria"/>
                        <field name="fecha_limite_inscripcion"/>
                        <field name="currency_id" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                        <field name="convocatoria_pdf_name" string="Nombre del Documento" invisible="True"/>
                        <field name="convocatoria_pdf" filename="convocatoria_pdf_name" string="Convocatoria" widget="binary"/>
                    </group>
                </group>
                <group string="Criterios de aprobación" invisible="origen_name != 'Público'">
                    <group>
                        <group>
                            <field name="tipo_obra_ok" readonly="stage_name not in ['Nuevas Convocatorias', 'Declinado']"/>
                        </group>
                        <group>
                            <field name="dependencia_ok" readonly="stage_name not in ['Nuevas Convocatorias', 'Declinado']"/>
                        </group>
                    </group>
                    <group>
                        <field name="capital_ok" readonly="stage_name not in ['Nuevas Convocatorias', 'Declinado']"/>
                    </group>
                </group>
            </xpath>

            <xpath expr="//sheet/notebook" position="inside">
                <page string="1ras. Etapas" invisible="stage_name == 'Nuevas Convocatorias'">
                    <group>
                        <group string="Inscripción/Compra de bases">
                            <group invisible="stage_name not in ('Inscripción/Compra de bases', 'Declinado')"/>
                            <group invisible="stage_name not in ('Inscripción/Compra de bases', 'Declinado')">
                                <list editable="bottom">
                                    <button name="action_send_bases" string="Enviar" type="object" icon="fa-envelope" invisible="not bases_pay"/><button name="action_authorize_bases" type="object" string="Autorizar bases" class="oe_highlight" groups="project_extra.group_conv_authorizer" invisible="not bases_pay or stage_name not in ('Inscripción/Compra de bases', 'Declinado')"/>
                                </list>
                            </group>
                            <field name="bases_doc_name" string="Nombre del Documento" invisible="True"/>
                            <group>
                                <field name="bases_pay" string="Pagar bases" readonly="stage_name not in ('Inscripción/Compra de bases', 'Declinado')"/>
                            </group>
                            <group>
                                <field name="bases_pagado" string="Pagado" readonly="1" invisible="not bases_pay or not bases_cost"/>
                            </group>
                            <group>
                                <field name="bases_notification_sent" readonly="1"/>
                            </group>
                            <group colspan="2">
                                <field name="bases_supervisor_id" readonly="stage_name != 'Inscripción/Compra de bases'"/>
                                <field name="fecha_apertura" string="Fecha de apertura" readonly="stage_name != 'Inscripción/Compra de bases'"/>
                                <field name="bases_cost" string="Costo de las bases" readonly="stage_name != 'Inscripción/Compra de bases'" invisible="not bases_pay"/>
                            </group>
                            <group>
                                <field name="bases_abstinencia_anticipo" readonly="stage_name != 'Inscripción/Compra de bases'"/>
                            </group>
                            <group>
                                <field name="bases_anticipo_porcentaje" readonly="stage_name != 'Inscripción/Compra de bases'"/>
                            </group>
                            <group colspan="2">
                                <field name="bases_modalidad_contrato_id" options="{'no_open':True, 'no_create':True, 'no_edit':True}" readonly="stage_name != 'Inscripción/Compra de bases'"/>
                            </group>
                            <group colspan="2">
                                <label for="bases_fecha_inicio_trabajos" string="Fecha estimada de trabajos (Inicio/Termino)"/>
                                <div class="o_row">
                                    <span class="oe_inline">Del  </span><field name="bases_fecha_inicio_trabajos" readonly="stage_name != 'Inscripción/Compra de bases'" class="oe_inline" nolabel="1"/><span class="oe_inline"> al </span><field name="bases_fecha_terminacion_trabajos" readonly="stage_name != 'Inscripción/Compra de bases'" class="oe_inline" nolabel="1"/>
                                </div>                                
                            </group>
                            <group colspan="2">
                                <label for="bases_plazo_ejecucion"/>
                                <div class="o_row">
                                    <field name="bases_plazo_ejecucion" readonly="stage_name != 'Inscripción/Compra de bases'" class="oe_inline"/>
                                    <span class="oe_inline"> días naturales</span>
                                </div>
                                <field name="bases_sancion_atraso" readonly="stage_name != 'Inscripción/Compra de bases'"/>
                            </group>
                            <group>
                                <field name="bases_ret_5_millar" readonly="stage_name != 'Inscripción/Compra de bases'"/>
                            </group>
                            <group>
                                <field name="bases_ret_2_millar" readonly="stage_name != 'Inscripción/Compra de bases'"/>
                            </group>
                            <group colspan="2">
                                <field name="bases_doc" string="Bases" filename="bases_doc_name" widget="binary" readonly="stage_name != 'Inscripción/Compra de bases'"/>
                            </group>
                        </group>
                        <group string="Visita de Obra">
                            <group>
                                <field name="visita_obligatoria" readonly="stage_name != 'Visita de Obra'"/>
                            </group>
                            <group>
                                <list editable="bottom" invisible="stage_name != 'Visita de Obra'">
                                    <button name="action_send_visita_reminder" string="Enviar" type="object" icon="fa-envelope"/>
                                </list>
                            </group>
                            <field name="visita_acta_name" invisible="1"/>
                            <group>
                                <field name="visita_notif_auto_sent" readonly="1"/>
                            </group>
                            <group>
                                <field name="visita_notif_manual_sent" readonly="1"/>
                            </group>
                            <group colspan="2">
                                <field name="visita_personas_ids" widget="many2many_tags" readonly="stage_name != 'Visita de Obra'" required="visita_obligatoria"/>
                                <field name="visita_fecha" string="Fecha y hora de visita" readonly="stage_name != 'Visita de Obra'"/>
                                <field name="visita_lugar_reunion" readonly="stage_name != 'Visita de Obra'"/>
                                <field name="visita_acta" filename="visita_acta_name" widget="binary" readonly="stage_name != 'Visita de Obra'"/>
                            </group>
                        </group>
                    </group>
                    <group string="Junta de Aclaración de Dudas">
                        <field name="junta_docto_dudas_name" invisible="1"/>
                        <field name="junta_acta_name" invisible="1"/>
                        <field name="junta_notificacion_1_name" invisible="1"/>
                        <field name="junta_notificacion_2_name" invisible="1"/>
                        <group>
                            <group>
                                <field name="junta_obligatoria" readonly="stage_name != 'Junta de Aclaración de Dudas'"/>
                            </group>
                            <group>
                                <list editable="bottom" invisible="stage_name != 'Junta de Aclaración de Dudas'">
                                    <button name="action_send_junta_reminder_manual" string="Enviar" type="object" icon="fa-envelope"/>
                                </list>
                            </group>
                            <group colspan="2">
                                <field name="junta_personas_ids" widget="many2many_tags" readonly="stage_name != 'Junta de Aclaración de Dudas'" required="junta_obligatoria and stage_name == 'Junta de Aclaración de Dudas'"/>
                                <field name="junta_fecha" string="Fecha y hora de junta" readonly="stage_name != 'Junta de Aclaración de Dudas'" required="junta_obligatoria and stage_name == 'Junta de Aclaración de Dudas'"/>
                                <field name="junta_fecha_limite_dudas" string="Fecha límite" readonly="stage_name != 'Junta de Aclaración de Dudas'" required="junta_obligatoria and stage_name == 'Junta de Aclaración de Dudas'"/>
                                <field name="junta_acta" filename="junta_acta_name" widget="binary" readonly="stage_name != 'Junta de Aclaración de Dudas'"/>
                            </group>
                        </group>
                        <group>
                            <group>
                                <field name="junta_notif_auto_sent" readonly="1"/>
                            </group>
                            <group>
                                <field name="junta_notif_manual_sent" readonly="1"/>
                            </group>
                            <group colspan="2">
                                <field name="junta_lugar_reunion" readonly="stage_name != 'Junta de Aclaración de Dudas'"/>
                                <field name="junta_docto_dudas" filename="junta_docto_dudas_name" widget="binary" readonly="stage_name != 'Junta de Aclaración de Dudas'"/>
                                <field name="junta_notificacion_1" filename="junta_notificacion_1_name" widget="binary" readonly="stage_name != 'Junta de Aclaración de Dudas'"/>
                                <field name="junta_notificacion_2" filename="junta_notificacion_2_name" widget="binary" readonly="stage_name != 'Junta de Aclaración de Dudas'"/>
                            </group>
                        </group>
                    </group>
                    <group>
                        <group string="Asignación de Responsables">
                            <field name="tecnico_documental_id" string="Técnico/documental" readonly="stage_name != 'Asignación de Responsables'"/>
                            <field name="economico_operativo_id" string="Económico/operativo" readonly="stage_name != 'Asignación de Responsables'"/>
                            <field name="analista_id" string="Analista" readonly="stage_name != 'Asignación de Responsables'"/>
                        </group>
                    </group>
                </page>

                <page string="Insumos">
                    <group invisible="stage_name != 'Cotización de insumos y trabajos especiales'">
                        <field name="input_filename" string="Archivo" invisible="1"/>
                        <field name="input_file" widget="binary" filename="input_filename"/>
                    </group>
                    <group invisible="stage_name != 'Cotización de insumos y trabajos especiales'">
                        <div class="oe_button_box" invisible="input_file == False">                                    
                            <button class="oe_stat_button" icon="fa-upload" name="action_cargar_insumos" string="Cargar" type="object" invisible="input_ids" confirm="Se agregará el contenido del archivo seleccionado, ¿continuar?"/>
                            <button class="oe_stat_button" icon="fa-upload" name="action_genera_insumos" string="Insumos" type="object" invisible="not input_ids" confirm="Se generarán los conceptos faltantes, es necesario complementar la información contable, ¿continuar?"/>
                            <button class="oe_stat_button" icon="fa-upload" name="action_genera_cotizaciones" string="Cotizaciones" type="object" invisible="not input_ids"/>
                            <button class="oe_stat_button" confirm="¿Está seguro que desea eliminar los registros cargados?" icon="fa-times" name="action_unlink_insumos" string="Eliminar Detalle" type="object" invisible="not input_ids"/>
                        </div>
                    </group>
                    <field name="input_ids" widget="one2many_list">
                        <list string="Detalles" delete="0" create="0" edit="0" context="{'default_lead_id': id}">
                            <field name="col1"/>
                            <field name="col2"/>
                            <field name="col3"/>
                            <field name="col4"/>
                            <field name="col5"/>
                            <field name="col6"/>
                            <field name="col7"/>
                            <field name="col8"/>
                            <field name="input_ex"/>
                            <field name="account_ex"/>
                            <field name="tipinsumo_ex"/>
                        </list>
                        <form><p>Información no disponible a través de esta vista</p></form>
                    </field>
                </page>

                <page string="Propuestas">
                    <notebook>
                        <page string="Documentación requerida">
                            <field name="documents_folder_id" widget="documents_folder_many2one" context="{'documents_project': True, 'default_company_id': company_id, 'default_type': 'folder'}" readonly="1"/>
                            <group string="Propuesta Técnica">
                                <field name="ptdcto_ids" widget="many2many_tags" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                            </group>
                            <group string="Propuesta Económica">
                                <field name="pedcto_ids" widget="many2many_tags" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                            </group>
                        </page>

                        <page string="Propuesta Técnica" name="pt_docs">
                            <button name="action_open_attachments" string="Documentos Técnica" type="object" context="{'folder_type': 'Tecnico'}" class="oe_stat_button" icon="fa-folder-open">
                                <field name="documents_count_tecnica" widget="statinfo" string="Docs"/>
                            </button>
                            <group string="Documentos Requeridos">
                                <field name="pt_doc_line_ids" nolabel="1">
                                    <list editable="bottom" delete="0" create="0">
                                        <field name="docto_id" string="Documento" readonly="1" options="{'no_open': True, 'no_create': True}"/>
                                        <field name="generado" string="¿Generado?"/>
                                    </list>
                                </field>
                            </group>
                            <group string="Revisiones">
                                <field name="pt_revision_ids" nolabel="1" readonly="stage_name != 'Propuesta Técnica'">
                                    <list editable="bottom" delete="0">
                                        <field name="fecha_revision"/>
                                        <field name="employee_id" string="Revisor" options="{'no_create': True, 'no_edit': True}"/>
                                        <field name="revisado" widget="boolean_toggle"/>
                                    </list>
                                </field>
                            </group>
                        </page>

                        <page string="Propuesta Económica" name="pe_docs">
                            <button name="action_open_attachments" string="Documentos Económica" type="object" context="{'folder_type': 'Economico'}" class="oe_stat_button" icon="fa-folder-open">
                                <field name="documents_count_economica" widget="statinfo" string="Docs"/>
                            </button>
                            <field name="pe_autorizado" invisible="1"/>
                            <group string="Documentos Requeridos">
                                <field name="pe_doc_line_ids" nolabel="1">
                                    <list editable="bottom" delete="0" create="0">
                                        <field name="docto_id" string="Documento" readonly="1" options="{'no_open': True, 'no_create': True}"/>
                                        <field name="generado" string="¿Generado?"/>
                                    </list>
                                </field>
                            </group>                    
                            <group string="Revisiones">
                                <field name="pe_revision_ids" nolabel="1" readonly="pe_autorizado">
                                    <list editable="bottom" create="not parent.pe_autorizado" delete="not parent.pe_autorizado">
                                        <field name="fecha_revision" readonly="parent.pe_autorizado"/>
                                        <field name="employee_ids" widget="many2many_tags" string="Nombre" options="{'no_create': True, 'no_edit': True}" readonly="parent.pe_autorizado"/>
                                        <field name="revisado" widget="boolean_toggle" readonly="parent.pe_autorizado"/>
                                        <field name="autorizado" widget="boolean_toggle" readonly="not revisado or not activo"/>
                                        <field name="activo" column_invisible="1"/>
                                    </list>
                                    <form>
                                        <group>
                                            <field name="fecha_revision"/>
                                            <field name="employee_ids" widget="many2many_tags" string="Nombre"/>
                                            <field name="revisado"/>
                                            <field name="autorizado" readonly="not revisado or not activo"/>
                                            <field name="activo" invisible="1"/>
                                            <div invisible="not activo" class="alert alert-info" role="alert">
                                                <p><strong>Esta es la revisión activa actual.</strong></p>
                                                <p>Primero marque como "Revisado", luego podrá marcar como "Autorizado".</p>
                                            </div>
                                            <div invisible="activo or not autorizado" class="alert alert-success" role="alert">
                                                <p><strong>✓ Revisión autorizada</strong></p>
                                            </div>
                                        </group>
                                    </form>
                                </field>
                            </group>
                            <div class="alert alert-success" role="alert" invisible="not pe_autorizado">
                                <strong>✓ Propuesta Económica AUTORIZADA</strong> - No se pueden añadir más líneas de revisión.
                            </div>
                        </page>
                    </notebook>
                </page>

                <page string="Juntas">
                    <group>
                        <group string="Junta de Apertura de Propuestas">
                            <group>
                                <field name="apertura_obligatoria" readonly="stage_name != 'Junta de Apertura de Propuestas'"/>
                            </group>
                            <group invisible="stage_name != 'Junta de Apertura de Propuestas'">
                                <list editable="bottom">
                                    <button name="action_send_apertura_reminder" type="object" icon="fa-envelope" string="Enviar"/>
                                </list>
                            </group>
                            <field name="apertura_acta_name" invisible="1"/>
                            <group>
                                <field name="apertura_notif_auto_sent" readonly="1"/>
                            </group>
                            <group>
                                <field name="apertura_notif_manual_sent" readonly="1"/>
                            </group>
                            <group colspan="2">
                                <field name="apertura_personas_ids" widget="many2many_tags" readonly="stage_name != 'Junta de Apertura de Propuestas'" required="apertura_obligatoria"/>
                                <field name="apertura_lugar_reunion" readonly="stage_name != 'Junta de Apertura de Propuestas'"/>
                                <field name="apertura_fecha" string="Fecha y hora de junta" readonly="stage_name != 'Junta de Apertura de Propuestas'" required="apertura_obligatoria"/>
                                <field name="apertura_acta" filename="apertura_acta_name" string="Acta de la junta" widget="binary" readonly="stage_name != 'Junta de Apertura de Propuestas'" required="apertura_obligatoria"/>
                            </group>
                        </group>
                        <group string="Junta de Fallo">
                            <field name="fallo_acta_name" invisible="1"/>
                             <group>
                                <field name="fallo_obligatoria" readonly="stage_name != 'Junta de Fallo'"/>
                            </group>
                            <group>
                                <list editable="bottom">
                                    <button name="action_send_fallo_notification" type="object" icon="fa-envelope" string="Enviar" invisible="stage_name != 'Junta de Fallo'"/>
                                </list>
                            </group>
                            <group colspan="2">
                                <field name="fallo_personas_ids" widget="many2many_tags" readonly="stage_name != 'Junta de Fallo'" required="fallo_obligatoria and stage_name == 'Junta de Fallo'"/>
                                <field name="fallo_lugar_reunion" readonly="stage_name != 'Junta de Fallo'"/>
                                <field name="fallo_fecha" string="Fecha y hora de junta" readonly="stage_name != 'Junta de Fallo'" required="fallo_obligatoria and stage_name == 'Junta de Fallo'"/>
                                <field name="fallo_acta" filename="fallo_acta_name" string="Acta de fallo" readonly="stage_name != 'Junta de Fallo'"/>
                            </group>
                            <group>
                                <field name="fallo_notif_auto_sent" readonly="1"/>
                                <field name="fallo_fecha_adjudicacion" string="Fecha de adjudicación" readonly="stage_name != 'Junta de Fallo'"/>
                            </group>
                            <group>
                                <field name="fallo_notif_manual_sent" readonly="1"/>
                                <field name="fallo_ganado" readonly="stage_name != 'Junta de Fallo' or fallo_acta_name == False"/>
                            </group>                            
                            <group invisible="not fallo_ganado"/>
                            <group invisible="not fallo_ganado">
                                <list editable="bottom">
                                    <button name="action_send_fallo_directores_notification" type="object" icon="fa-envelope" string="Enviar a Dirección"/>
                                </list>
                            </group>
                            <group invisible="not fallo_ganado">
                                <field name="fallo_notif_directores_auto_sent" readonly="1"/>
                            </group>
                            <group invisible="not fallo_ganado">
                                <field name="fallo_notif_directores_manual_sent" readonly="1"/>
                            </group>
                        </group>
                    </group>
                </page>

                <page string="Ganado">
                    <group invisible="stage_name != 'Ganado'">
                        <group>
                            <field name="doctoconcept_id" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                            <field name="doctomatriz_id" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                        </group>
                        <group>
                            <field name="doctobasicos_id" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                        </group>
                    </group>
                    <group invisible="stage_name != 'Ganado'">
                        <div class="oe_button_box">
                            <button class="oe_stat_button" icon="fa-upload" name="action_cargar_concept" string="Cargar" type="object" invisible="concept_ids" confirm="Se agregará el contenido del documento E02, ¿continuar?"/>
                            <button class="oe_stat_button" icon="fa-upload" name="action_genera_partidas" string="Partidas" type="object" invisible="not concept_ids"/>
                            <button class="oe_stat_button" icon="fa-upload" name="action_genera_concept" string="Conceptos" type="object" invisible="not concept_ids" confirm="Se generarán los conceptos faltantes, es necesario complementar la información contable, ¿continuar?"/>
                            <button class="oe_stat_button" icon="fa-upload" name="action_cargar_combo" string="Cargar Dcto de Analisis" type="object" invisible="combo_ids"/>
                            <button class="oe_stat_button" icon="fa-upload" name="action_cargar_basicos" string="Cargar Basicos" type="object" invisible="basico_ids"/>
                            <button class="oe_stat_button" icon="fa-upload" name="action_generar_basicos" string="Generar Basicos" type="object" invisible="not basico_ids"/>
                            <button class="oe_stat_button" icon="fa-upload" name="action_generar_combo" string="Generar Dcto de Analisis" type="object" invisible="not combo_ids"/>
                        </div>
                    </group>
                    <notebook>
                        <page string="Información">
                            <field name="contrato_documento_name" invisible="1"/>
                            <field name="orden_trabajo_doc_name" invisible="1"/>
                            <field name="es_siop" invisible="1"/>
                            <group>
                                <group>
                                    <field name="fecha_limite_firma" readonly="stage_name != 'Ganado'" required="stage_name == 'Ganado'"/>
                                    <field name="contrato_firmado" readonly="stage_name != 'Ganado'"/>
                                    <field name="importe_contratado" readonly="stage_name != 'Ganado'"/>
                                    <field name="rupc_siop" readonly="stage_name != 'Ganado'" invisible="not es_siop" string="RUPC.SIOP"/>
                                    <field name="contrato_documento" filename="contrato_documento_name" readonly="stage_name != 'Ganado'"/>
                                    <field name="orden_trabajo_doc" filename="orden_trabajo_doc_name" readonly="stage_name != 'Ganado'" string="Orden de trabajo"/>
                                </group>
                                <group>
                                    <field name="fecha_firma" readonly="stage_name != 'Ganado'" required="stage_name == 'Ganado' and contrato_firmado"/>
                                    <field name="importe_anticipo" invisible="bases_abstinencia_anticipo"/>
                                    <field name="no_estimaciones" readonly="stage_name != 'Ganado'" string="No. De estimaciones"/>
                                </group>
                            </group>
                        </page>
                        <page string="Conceptos de Obra">
                            <group>
                                <group string="Partidas presupuestales">
                                    <field name="budget_ids" nolabel="1" widget="one2many_list">                        
                                        <list delete="0" create="0" edit="0" context="{'default_lead_id': id}">
                                            <field name="col1"/>
                                            <field name="col2"/>
                                            <field name="budget_id"/>
                                        </list>
                                        <form><p>Información no disponible a través de esta vista</p></form>
                                    </field>
                                </group>
                                <group string="Conceptos de trabajo">
                                    <field name="concept_ids" nolabel="1" widget="one2many_list">                        
                                        <list delete="0" create="0" edit="0" context="{'default_lead_id': id}">
                                            <field name="col1"/>
                                            <field name="col2"/>
                                            <field name="col3"/>
                                            <field name="col4"/>
                                            <field name="col5"/>
                                            <field name="concept_ex"/>
                                            <field name="account_ex"/>
                                            <field name="combo_ex"/>
                                        </list>
                                        <form><p>Información no disponible a través de esta vista</p></form>
                                    </field>
                                </group>
                            </group>
                        </page>
                        <page string="Análisis de precios">
                            <group>
                                <field name="combo_ids" nolabel="1" widget="one2many_list">                        
                                    <list delete="0" create="0" edit="0" context="{'default_lead_id': id}">
                                        <field name="col1"/>
                                        <field name="col2"/>
                                        <field name="col3"/>
                                        <field name="col4"/>
                                        <field name="col5"/>
                                        <field name="col6"/>
                                        <field name="col7"/>
                                        <field name="combo_ex"/>
                                    </list>
                                    <form><p>Información no disponible a través de esta vista</p></form>
                                </field>
                            </group>
                        </page>
                        <page string="Básicos">
                            <group>
                                <field name="basico_ids" nolabel="1" widget="one2many_list">                        
                                    <list delete="0" create="0" edit="0" context="{'default_lead_id': id}">
                                        <field name="basico"/>
                                        <field name="col1"/>
                                        <field name="col2"/>
                                        <field name="col3"/>
                                        <field name="col4"/>
                                        <field name="col5"/>
                                        <field name="col6"/>
                                        <field name="combo_ex"/>
                                    </list>
                                    <form><p>Información no disponible a través de esta vista</p></form>
                                </field>
                            </group>
                        </page>
                    </notebook>
                </page>

                <page string="Órdenes de compra">
                    <field name="oc_ids" widget="one2many_list">
                        <list string="Ordenes de compra" delete="0" create="0" edit="0" context="{'default_lead_id': id}">
                            <field name="name"/>
                            <field name="partner_id"/>
                            <field name="type_purchase"/>
                            <field name="amount_untaxed"/>
                            <field name="amount_total"/>
                            <field name="state"/>
                        </list>
                        <form><p>Información no disponible a través de esta vista</p></form>
                    </field>
                </page>

                <page string="Bitácora">
                    <field name="revert_log_ids" nolabel="1" readonly="1" context="{'default_lead_id': id}">
                        <list>
                            <field name="create_date" string="Fecha"/>
                            <field name="user_id"/>
                            <field name="old_stage_id"/>
                            <field name="new_stage_id"/>
                            <field name="reason_id"/>
                            <field name="reason_text"/>
                        </list>
                        <form>
                            <group>
                                <field name="user_id" readonly="1" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                                <field name="old_stage_id" readonly="1" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                                <field name="new_stage_id" readonly="1" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                                <field name="reason_id" readonly="1" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                                <field name="reason_text" readonly="1" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                                <field name="create_date" readonly="1" options="{'no_open':True, 'no_create':True, 'no_edit':True}"/>
                            </group>
                        </form>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record id="view_crm_lead_oppor_inherit_form" model="ir.ui.view">
        <field name="name">view.crm.lead.oppor.inherit.form</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="sale_crm.crm_case_form_view_oppor"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_sale_quotations_new']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>
</odoo>
